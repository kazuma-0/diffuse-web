(()=>{importScripts("version.js");var i="diffuse-"+self.VERSION,h=["_headers","_redirects","CORS"];self.addEventListener("activate",t=>{t.waitUntil(self.clients.claim())});self.addEventListener("install",t=>{let r=self.location.href.replace("service-worker.js",""),n=u().then(e=>fetch("tree.json")).then(e=>e.json()).then(e=>{let s=e.filter(a=>!h.find(o=>o===a)),c=[r,`${r.replace(/\/+$/,"")}/about/`].concat(s);return caches.open(i).then(a=>Promise.all(c.map(o=>a.add(o))))}).then(e=>self.skipWaiting());t.waitUntil(n)});self.addEventListener("fetch",t=>{let r=!!t.request.url.match(new RegExp("^"+self.location.origin)),n=!self.navigator.onLine;if(t.request.url.includes("service_worker_authentication=")){let e=new URL(t.request.url),s=e.searchParams.get("service_worker_authentication");e.searchParams.delete("service_worker_authentication"),e.search="?"+e.searchParams.toString(),l(t,e.toString(),"Basic "+s)}else if(t.request.url.includes("access_token=")){let e=new URL(t.request.url),s=e.searchParams.get("access_token");e.searchParams.delete("access_token"),e.search="?"+e.searchParams.toString(),l(t,e.toString(),"Bearer "+s)}else if(r){let e=new URL(t.request.url);e.search="",t.respondWith(caches.open(i).then(s=>s.match(e)).then(s=>s||fetch(e))),!n&&t.request.mode!=="navigate"&&t.waitUntil(caches.open(i).then(s=>fetch(e).then(c=>c.clone()).then(c=>s.put(e,c))).catch(s=>{console.error("Could not fetch "+e.href),console.error(s)}))}});function l(t,r,n,e){let s=new Headers(t.request.headers);s.set("authorization",n);let c=new Request(new Request(r,t.request),{headers:s,mode:e||"cors",cache:"no-cache",credentials:"include"});t.respondWith(fetch(c))}function u(){return caches.keys().then(t=>{let r=t.map(n=>caches.delete(n));return Promise.all(r)})}})();
